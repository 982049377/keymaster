//     keymaster.js
//     (c) 2011 Thomas Fuchs
//     keymaster.js may be freely distributed under the MIT license.
(function(a){function m(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,function(){c(window.event)})}function l(a){e=a||"all"}function k(a,b,d){var e,h,i,j,k,l;d===undefined&&(d=b,b="all"),a=a.replace(/\s/g,""),e=a.split(",");for(i=0,k=e.length;i<k;i++){h=[],a=e[i].split("+");if(a.length>1){h=a.slice(0,a.length-1);for(j=0,l=h.length;j<l;j++)h[j]=f[h[j]];a=[a[a.length-1]]}a=a[0],a=a.length>1?g[a]:a.toUpperCase().charCodeAt(0),a in c||(c[a]=[]),c[a].push({scope:b,method:d,key:e[i],mods:h})}}function j(a){var b=a.keyCode,c;if(b in d){d[b]=!1;for(c in f)f[c]==b&&(k[c]=!1)}}function i(a){var b,g,h,i,j,l,m;g=(a.target||a.srcElement).tagName,b=a.keyCode;if(b in d){d[b]=!0;for(i in f)f[i]==b&&(k[i]=!0)}else{if(g=="INPUT"||g=="SELECT"||g=="TEXTAREA")return;if(!(b in c))return;for(j=0,l=c[b].length;j<l;j++){h=c[b][j];if(h.scope==e||h.scope=="all"){m=h.mods.length>0;for(i in d)if(!d[i]&&h.mods.indexOf(+i)>-1||d[i]&&h.mods.indexOf(+i)==-1)m=!1;(h.mods.length==0&&!d[16]&&!d[18]&&!d[17]&&!d[91]||m)&&h.method(a,h.key,h.scope)===!1&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble&&a.cancelBubble(),a.preventDefault?a.preventDefault():a.returnValue=!1)}}}}function h(a,b,c,d,e){for(d=0,e=a;d<e.length;d++)if(!b.call(c,e[d],d,e))return!1;return!0}var b,c={},d={16:!1,18:!1,17:!1,91:!1},e="all",f={shift:16,option:18,"⌥":18,alt:18,ctrl:17,control:17,command:91,"⌘":91},g={backspace:8,tab:9,enter:13,"return":13,escape:27,space:32,left:37,up:38,right:39,down:40};for(b in f)k[b]=!1;m(document,"keydown",i),m(document,"keyup",j),a.key=k,a.key.setScope=l})(this)