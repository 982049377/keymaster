//     keymaster.js
//     (c) 2011 Thomas Fuchs
//     keymaster.js may be freely distributed under the MIT license.
(function(a){function k(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,function(){c(window.event)})}function j(a){d=a||"all"}function i(a,c,d){var g,h,i,j,k,l;d===undefined&&(d=c,c="all"),a=a.replace(/\s/g,""),g=a.split(",");for(i=0,k=g.length;i<k;i++){h=[],a=g[i].split("+");if(a.length>1){h=a.slice(0,a.length-1);for(j=0,l=h.length;j<l;j++)h[j]=e[h[j]];a=[a[a.length-1]]}a=a[0],a=a.length>1?f[a]:a.toUpperCase().charCodeAt(0),a in b||(b[a]=[]),b[a].push({scope:c,method:d,key:g[i],mods:h})}}function h(a){var b=a.keyCode;b in c&&(c[b]=!1)}function g(a){var e,f,g,h,i,j,k;f=(a.target||a.srcElement).tagName,e=a.keyCode;if(e in c)return c[e]=!0;if(f!="INPUT"&&f!="SELECT"&&f!="TEXTAREA"){if(!(e in b))return;for(var h=0,i=b[e].length;h<i;h++){var g=b[e][h];if(g.scope==d||g.scope=="all"){var l=g.mods.length>0&&function(){for(var a=0,b=g.mods.length;a<b;a++)if(!c[g.mods[a]])return!1;return!0}();(g.mods.length==0&&!c[16]&&!c[18]&&!c[17]&&!c[91]||l)&&g.method(a,g.key,g.scope)===!1&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble&&a.cancelBubble(),a.preventDefault?a.preventDefault():a.returnValue=!1)}}}}var b={},c={16:!1,18:!1,17:!1,91:!1},d="all",e={shift:16,option:18,"⌥":18,alt:18,ctrl:17,control:17,command:91,"⌘":91},f={backspace:8,tab:9,enter:13,"return":13,escape:27,space:32,left:37,up:38,right:39,down:40};k(document,"keydown",g),k(document,"keyup",h),a.key=i,a.key.setScope=j})(this)